import{j as e,r as h,a as je}from"./react-pyWNicHf.js";import{b as be}from"./react-dom-DaPlfP5C.js";import{A as p}from"./leancloud-storage-o0EwsFi_.js";import{s as R,S as A,T as se,B as K,L as N,D as G,F as H,I as L,a as T,P as z,C as ae,M as ye,b as ge,A as le,R as Se,c as V,d as re,e as oe,f as Ie}from"./antd-DAS6H9JJ.js";import{L as f,u as q,B as ve}from"./react-router-dom-CVtk8eOe.js";import{B as Q,C as Te,D as we,E as he,G as Ce,H as Ae,J as Oe}from"./@ant-design-CkDbgUbb.js";import{Q as ue,i as Me}from"./md-editor-rt-CqeipRC5.js";import{u as me,a as _,d as Le,e as Ne}from"./react-router-j14Ueec2.js";import{m as J}from"./js-md5-UmE8huoo.js";import{p as w}from"./pubsub-js-DKsWzxX6.js";import"./classnames-DrtxxsZ5.js";import"./scheduler-Bb8JjhAW.js";import"./rc-util-DrNLs0Sa.js";import"./@babel-BlIIM1Tk.js";import"./react-is-BpBQ4hf7.js";import"./rc-resize-observer-DDH0kaLk.js";import"./resize-observer-polyfill-D6qJbdzf.js";import"./rc-motion-C-kdRULV.js";import"./rc-dropdown-hdxrbMhT.js";import"./@rc-component-CfJTwUQL.js";import"./rc-menu-BDE0ZiR4.js";import"./rc-overflow-BJ3Kw50f.js";import"./rc-tabs-UcLePfXK.js";import"./rc-select-B1Dsgljj.js";import"./rc-virtual-list-c4piO5bs.js";import"./rc-checkbox-D4dVWoQK.js";import"./rc-field-form-tuI5lY9E.js";import"./scroll-into-view-if-needed-Bq0bK-M8.js";import"./compute-scroll-into-view-Bl8rNFhg.js";import"./rc-dialog-BT-3KWbF.js";import"./rc-input-CXGxMpf6.js";import"./rc-textarea-BJkS2gDC.js";import"./rc-pagination-DTV34-xE.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-Dv4Nucp9.js";import"./rc-tooltip-D7AYWjNN.js";import"./rc-picker-Ce8wNz7V.js";import"./@remix-run-Ci2Y9YYq.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./@vavt-BhS2ZNLz.js";import"./lucide-react-B1CG_ASX.js";import"./@codemirror-BUSX5JHM.js";import"./@lezer-BkZr8DQx.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bs6eFhZE.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-bWEtUbjf.js";import"./markdown-it-B_KdP_AI.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-DaOgEp9O.js";import"./markdown-it-image-figures-IpqUZCLv.js";import"./markdown-it-sub-Bxi31R0z.js";import"./markdown-it-sup-Bp2DoVCN.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function g(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=g(a);fetch(a.href,r)}})();function Re(){const i=new p.Object("Init"),d=new p.Object("LeaniteInfo");d.set("version","0.1.0");const g=new p.Object("BlogMeta");g.set("title","Hello World!"),g.set("id","1"),g.set("reader",1),g.set("tags",["Leanite"]);const s=new p.Object("BlogContent");s.set("title","Hello World!"),s.set("id","1"),s.set("content",`**欢迎使用 Leanite！**这是你的第一篇博客。

访问 [Leanite 的 GitHub 仓库](https://github.com/copws/leanite/) 获取更多信息。`);const a=new p.Object("Settings");a.set("owner","admin"),a.set("bulletin","Hello, World!");const r=new p.Object("Tags");r.set("name","Leanite"),r.set("ids",["1"]),p.Object.saveAll([i,d,g,s,a,r]).then(n=>R.success("初始化成功！"),n=>R.error("初始化失败"))}const U=i=>p.parseJSON(i.toFullJSON());function Y(i,d){for(let g in i){const s=i[g];if(!d.find(a=>a===s))return!1}return!0}const ke="6etdzH2DJEoNM5Dq80rfyljk-gzGzoHsz",Be="3EThSFNCw1QZRRN2JyGNneq5",De="https://6etdzh2d.lc-cn-n1-shared.com";function S(i){return e.jsx(A,{direction:"vertical",style:{marginTop:"30px",padding:"20px",backgroundColor:"white",borderRadius:"7px",boxShadow:"0 0 40px 0px rgba(0,0,0,0.04)",width:"100%"},children:i.children})}const pe=i=>{const{meta:d}=i;return e.jsxs(A,{direction:"horizontal",children:[e.jsx("strong",{children:e.jsx(f,{to:"/leanite/article?id="+d.id,style:{color:"black"},children:d.title})}),d.tags.map(g=>e.jsx(se,{children:e.jsx(f,{to:"/leanite/tag?name="+g,children:g})})),e.jsx("div",{style:{color:"grey"},children:new Date(d.createdAt).toLocaleDateString()})]})},ce=i=>{const{children:d}=i;return e.jsx(A,{direction:"horizontal",className:"leanite-minicard",children:d})};function Ee(){let[i,d]=h.useState([]),[g,s]=h.useState([]),[a]=q(),r=a.get("name");return h.useEffect(()=>{d(JSON.parse(localStorage.getItem("tags"))),s(JSON.parse(localStorage.getItem("blogMeta")))},[]),e.jsxs("div",{children:[e.jsxs(S,{children:[e.jsx(K,{items:[{title:e.jsx(f,{to:"/leanite/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/leanite/tag",children:"标签"})}]}),e.jsxs(A,{style:{marginTop:"15px"},children:[e.jsx(f,{style:{color:"black"},to:"/leanite/tag",children:e.jsx(ce,{children:e.jsx("strong",{children:"标签总览"})})}),i.map(n=>e.jsx(f,{style:{color:"black"},to:"/leanite/tag?name="+n.name,children:e.jsx(ce,{children:e.jsx("strong",{children:"#"+n.name})})}))]})]}),e.jsx(S,{children:r&&i.length>0?e.jsx(N,{header:e.jsx("div",{children:r}),dataSource:i.find(n=>n.name===r)?.ids,renderItem:n=>e.jsx(N.Item,{children:e.jsx(pe,{meta:g.find(b=>b.id===n)})})}):e.jsx(N,{header:e.jsx("div",{children:"标签总览"}),dataSource:i,renderItem:n=>e.jsx(N.Item,{children:e.jsx(f,{to:"/leanite/tag?name="+n.name,children:n.name})})})})]})}function Je(){const[i,d]=h.useState([]),[g,s]=h.useState([]);return h.useEffect(()=>{s(JSON.parse(localStorage.getItem("blogMeta"))),(async()=>d(await new p.Query("BlogContent").descending("createdAt").limit(5).find()))()},[]),e.jsxs("div",{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/leanite/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/leanite/home",children:"首页"})}]})}),i.map(a=>{const r=g.find(n=>n.id===a.get("id"));return e.jsxs(S,{children:[e.jsx("h2",{children:e.jsx(f,{to:"/leanite/article?id="+a.get("id"),style:{color:"black"},children:a.get("title")})}),e.jsxs(A,{style:{color:"grey",width:"100%"},children:["阅读量：",r.reader-1,e.jsx(G,{type:"vertical"}),"发布：",new Date(r.createdAt).toLocaleDateString(),e.jsx(G,{type:"vertical"}),"标签：",r?.tags.length>0?r.tags.map(n=>e.jsx(se,{children:e.jsx(f,{to:"/leanite/tag?name="+n,children:n})})):"无"]}),e.jsx(A,{style:{marginTop:"10px",width:"100%"},children:e.jsx(ue,{value:a.get("content"),previewTheme:"github",style:{width:"100%"}})})]},Math.random())})]})}let de="";const Ue=()=>{const i=me(),[d]=q();let[g,s]=h.useState(),[a,r]=h.useState([]),[n,b]=h.useState([[]]);const m=d.get("id"),o=_();h.useEffect(()=>{if(a=JSON.parse(localStorage.getItem("blogMeta")),r(a),console.log(i.search,m),m&&de!==m&&(de=m,new p.Query("BlogContent").equalTo("id",m).find().then(c=>{s(U(c[0]))}),new p.Query("BlogMeta").equalTo("id",m).find().then(c=>setTimeout(()=>U(c[0]).increment("reader",1).save(),5e3))),!m&&(n.length<=0||n[0].length<=0)){n=[];let c=1/0;for(let x in a){const C=a[x],O=new Date(C.createdAt).getFullYear();O<c?(n.push([C]),c=O):n[n.length-1].push(C)}b(n),o("/leanite/article")}},[i]);let l={title:"",createdAt:"",reader:1,tags:[]};return m&&a.length>0&&(l=a.find(c=>c.id===m)),e.jsx("div",{children:e.jsx("div",{children:m?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/leanite/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/leanite/article?id="+m,children:l.title})}]})}),e.jsxs(S,{children:[e.jsx("h1",{children:l.title}),e.jsxs(A,{style:{color:"grey"},children:["阅读量：",l.reader-1,e.jsx(G,{type:"vertical"}),"发布：",new Date(l.createdAt).toLocaleDateString(),e.jsx(G,{type:"vertical"}),"标签：",l?.tags.length>0?l.tags.map(c=>e.jsx(se,{children:e.jsx(f,{to:"/leanite/tag?name="+c,children:c})})):"无"]}),e.jsx(ue,{value:g?.get("content"),previewTheme:"github"})]},Math.random())]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/leanite/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/leanite/article",children:"归档"})}]})}),n.length>0&&n[0].length>0?n.map(c=>e.jsxs(S,{children:[e.jsx("h3",{children:new Date(c[0].createdAt).getFullYear()}),c.map(x=>e.jsx(pe,{meta:x}))]})):e.jsx(e.Fragment,{})]})})})},Fe=i=>{J.md5(i.username+"+"+J.md5(i.password))===fe&&J.md5(i.password+"+"+J.md5(i.username))===xe?(R.success("验证成功！"),w.publish("auth")):R.error("验证失败！")},Pe=i=>{for(let d in i.errorFields)R.error(i.errorFields[d].errors)};let fe,xe;function _e(){return h.useEffect(()=>{new p.Query("Settings").equalTo("owner","admin").find().then(i=>{const d=i[0];fe=d.get("passkey1"),xe=d.get("passkey2")})},[]),e.jsx(S,{children:e.jsxs(H,{name:"basic",labelCol:{span:4},wrapperCol:{span:18},style:{maxWidth:600},onFinish:Fe,onFinishFailed:Pe,autoComplete:"off",children:[e.jsx(H.Item,{wrapperCol:{offset:4,span:18},children:e.jsx("h3",{children:"管理员登录"})}),e.jsx(H.Item,{label:"账号",name:"username",rules:[{required:!0,message:"请输入管理员账号"}],children:e.jsx(L,{})}),e.jsx(H.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入管理员密码"}],children:e.jsx(L.Password,{})}),e.jsx(H.Item,{wrapperCol:{offset:4,span:18},children:e.jsx(T,{type:"primary",htmlType:"submit",children:"确认"})})]})})}let Z=!1;function He(){const i=_();h.useEffect(()=>(w.subscribe("setAuth",(g,s)=>{s||(R.error("您需要登录"),Z=!0,i("/leanite/authentication"))}),Z||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),Z=!1}),[]);const d=()=>{const g=JSON.parse(localStorage.getItem("tags")),s=JSON.parse(localStorage.getItem("blogMeta"));let a=JSON.parse(localStorage.getItem("tagsOriginal")),r=JSON.parse(localStorage.getItem("blogMetaOriginal"));const n=[],b=[];console.log(g,s,a,r);for(let m in s){const o=s[m];if(o.objectId.length<=0){console.log("This meta hasn't created yet, "+o.title,o.id);const l=new p.Object("BlogMeta");l.set("title",o.title),l.set("reader",1),l.set("tags",o.tags),l.set("id",o.id),b.push(l)}else{const l=r.find(x=>x.id===o.id);if(r=r.filter(x=>x.id!==o.id),!l)continue;let c;l.title!==o.title&&(c=p.Object.createWithoutData("BlogMeta",l.objectId),c.set("title",o.title)),console.log(o.title,l.tags,o.tags,Y(l.tags,o.tags)),Y(l.tags,o.tags)||(c||(c=p.Object.createWithoutData("BlogMeta",l.objectId)),c.set("tags",o.tags)),c&&b.push(c)}}for(let m in g){const o=g[m];if(o.objectId.length<=0){console.log("This tag hasn't created yet, "+o.name);const l=new p.Object("Tags");l.set("name",o.name),l.set("ids",o.ids),n.push(l)}else{const l=a.find(x=>x.objectId===o.objectId);if(a=a.filter(x=>x.objectId!==o.objectId),!l)continue;let c;l.name!==o.name&&(c=p.Object.createWithoutData("Tags",l.objectId),c.set("name",o.name)),Y(l.ids,o.ids)||(c||(c=p.Object.createWithoutData("tags",l.objectId)),c.set("ids",o.ids)),c&&n.push(c)}}if(console.log(b,n,a,r),b.length<=0&&n.length<=0&&a.length<=0&&r.length<=0)console.log("everything is up-to-date");else{p.Object.saveAll(n).then(()=>console.log("tag 上传成功！")),p.Object.saveAll(b).then(()=>console.log("meta 上传成功！"));for(let m in a)p.Object.createWithoutData("Tags",a[m].objectId).destroy();for(let m in r)p.Object.createWithoutData("BlogMeta",r[m].objectId).destroy();localStorage.setItem("blogMetaOriginal",JSON.stringify(s)),localStorage.setItem("tagsOriginal",JSON.stringify(g))}};return e.jsxs("div",{children:[e.jsxs(S,{children:[e.jsx("strong",{children:"Leanite 控制台"}),e.jsxs("p",{children:["这个小按钮可以帮你把更改保存至 LeanCloud 云端，所以更改后不要忘了保存哦！",e.jsx("br",{}),"但是文章内容的编辑和设置选项是直接保存的，无需通过这个按钮。"]}),e.jsx(T,{type:"primary",onClick:d,children:"上传至云端"})]}),e.jsx(S,{children:e.jsxs("p",{children:[e.jsx("strong",{children:"使用说明"}),e.jsx("br",{}),e.jsx("br",{}),"控制台中，你可以更改文章、标签及设置。",e.jsx("br",{}),"具体帮助详见 ",e.jsx("a",{href:"https://github.com/copws/leanite",children:"GitHub"}),"。"]})})]})}let X=!1;function ze(){let[i,d]=h.useState([]);const g=t=>{localStorage.setItem("tags",JSON.stringify(t)),d(t)};let[s,a]=h.useState([]);const r=t=>{localStorage.setItem("blogMeta",JSON.stringify(t)),a(t)},n=_();let[b]=q();const m=b.get("id"),o=b.get("new");let l={title:"",createdAt:"",id:"",objectId:"",reader:0,tags:[],updatedAt:""};h.useEffect(()=>(w.subscribe("setAuth",(t,F)=>{F?(console.log("%"),g(JSON.parse(localStorage.getItem("tags"))),r(JSON.parse(localStorage.getItem("blogMeta")))):(R.error("您需要登录"),X=!0,n("/leanite/authentication"))}),X||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),X=!1}),[]);const[c,x]=h.useState(),[C,O]=h.useState(""),[k,y]=h.useState();return m&&C.length<=0&&(o?l={objectId:"",createdAt:"",updatedAt:"",title:"默认标题",tags:[],reader:0,id:""}:l=s.find(t=>t.id===m),console.log(l),O(l.title),n(o?"/leanite/modifyArticle?id="+m+"&new=1":"/leanite/modifyArticle?id="+m)),e.jsx("div",{children:m&&s.length>0?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(A,{direction:"horizontal",children:[e.jsx("strong",{children:"标题："}),e.jsx(L,{value:C,onChange:t=>O(t.currentTarget.value)}),e.jsx(z,{title:o?"确认创建":"确认更改",description:"你确定要"+(o?"创建":"更改")+"文章吗？此操作不可撤销。",onConfirm:()=>{o||(s[s.findIndex(t=>t.id===m)].title=C,r(s)),k?.set("title",C),k?.set("content",c),k?.save().then(t=>{R.success("成功"),o&&s.push({objectId:"",createdAt:"",title:C,tags:[],reader:0,id:t.get("id"),updatedAt:""}),r(s),n("/leanite/modifyArticle")},t=>R.error("出错了！"+t))},okText:"确认",cancelText:"取消",children:e.jsx(T,{type:"primary",children:"完成"})}),e.jsx(z,{title:"确认取消",description:"你确定要取消"+(o?"创建":"更改")+"吗？此操作不可撤销。",onConfirm:()=>{O(""),x(""),y(void 0),n("/leanite/modifyArticle")},okText:"确认",cancelText:"取消",children:e.jsx(T,{children:"取消"})})]})}),e.jsx(Me,{value:c,onChange:t=>{x(t)},style:{marginTop:"30px",border:0},previewTheme:"github"})]}):e.jsx(S,{children:e.jsx(N,{header:"文章总览",pagination:{position:"bottom",align:"center",pageSize:5,total:s.length},footer:e.jsx(T,{onClick:()=>{const t=new p.Object("BlogContent");t.set("id",J.md5(new Date().toString()+Math.random())),t.set("content",""),t.set("title",""),console.log(t),y(t),n("/leanite/modifyArticle?id="+t.get("id")+"&new=1")},type:"primary",style:{float:"right"},children:"创建新文章"}),dataSource:s,renderItem:t=>{const F=s.findIndex(D=>D===t);function B(){for(let D in t.tags){const W=i.findIndex(v=>v.name===t.tags[D]);i[W].ids=i[W].ids.filter(v=>v!==t.id)}g(i)}return e.jsx(N.Item,{actions:[e.jsx(T,{onClick:()=>{new p.Query("BlogContent").equalTo("id",t.id).find().then(D=>{x(U(D[0]).get("content")),y(U(D[0])),n("/leanite/modifyArticle?id="+t.id)}),n("/leanite/modifyArticle?id="+t.id)},children:"编辑"}),e.jsx(z,{title:"删除文章",description:"你确定要删除文章吗？",onConfirm:()=>{B(),s.splice(F,1),r(s),console.log(i),n("/leanite/modifyArticle")},okText:"确认",cancelText:"取消",children:e.jsx(T,{danger:!0,children:"删除"})})],children:e.jsx(f,{to:"/leanite/article?id="+t.id,children:t.title})})}})})})}let ee=!1;function Qe(){let[i,d]=h.useState([]);const g=u=>{localStorage.setItem("tags",JSON.stringify(u)),d(u)};let[s,a]=h.useState([]);const r=u=>{localStorage.setItem("blogMeta",JSON.stringify(u)),a(u)};let[n,b]=h.useState(new Array(i.length).fill(!1)),[m]=q(),o=m.get("name");const l=_();h.useEffect(()=>(w.subscribe("setAuth",(u,j)=>{j?(g(JSON.parse(localStorage.getItem("tags"))),r(JSON.parse(localStorage.getItem("blogMeta")))):(R.error("您需要登录"),ee=!0,l("/leanite/authentication"))}),ee||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),ee=!1}),[l]);function c(u,j){const M=i[u];for(let I in s)M.ids.includes(s[I].id)&&(s[I].tags=s[I].tags.filter($=>$!==j),s[I].tags.push(M.name));r(s),console.log(s)}function x(u){const j=i[u];for(let M in s)s[M].tags=s[M].tags.filter(I=>I!==j.name);r(s),console.log(s),n.splice(u,1),b(n)}let[C,O]=h.useState(!1),[k,y]=h.useState("");const t=()=>{k.length>0&&(i.push({name:k,ids:[],objectId:"",createdAt:"",updatedAt:""}),g(i)),O(!1),y(""),l("/leanite/modifyTags")};let[F,B]=h.useState(!1),[D,W]=h.useState([]);const v=i?.find(u=>u.name===o);return e.jsxs("div",{children:[e.jsx(S,{children:o&&i.length>0?F?e.jsx(ae.Group,{style:{width:"100%"},onChange:u=>{console.log("checked = ",u),W(u)},defaultValue:v?.ids,children:e.jsx(N,{style:{width:"100%"},pagination:{position:"bottom",align:"center",pageSize:5,total:s.length},header:e.jsx("div",{children:o}),footer:e.jsx(T,{onClick:()=>{if(console.log(v),v.ids!==D){for(let u in D){const j=D[u],M=s.findIndex(I=>I.id===j);!v?.ids.includes(j)&&!s[M].tags.includes(v.name)?s[M].tags.push(v.name):v.ids=v.ids.filter(I=>I!==j)}for(let u in v.ids){const j=v.ids[u],M=s.findIndex(I=>I.id===j);s[M].tags=s[M].tags.filter(I=>I!==v?.name)}r(s),i[i.findIndex(u=>u.name===o)].ids=D,g(i),B(!1),l("/leanite/modifyTags?name="+o)}},type:"primary",style:{float:"right"},children:"完成"}),dataSource:s,renderItem:u=>e.jsx(N.Item,{children:e.jsx(ae,{value:u.id,children:u.title})})})}):e.jsx(N,{header:e.jsx("div",{children:o}),pagination:{position:"bottom",align:"center",pageSize:5,total:v.ids.length},footer:e.jsxs(A,{direction:"horizontal",style:{float:"right"},children:[e.jsx(T,{type:"primary",onClick:()=>{B(!0),l("/leanite/modifyTags?name="+o)},children:"添加或删除文章……"}),e.jsx(f,{to:"/leanite/modifyTags",children:e.jsx(T,{children:"返回上一级"})})]}),dataSource:v?.ids,renderItem:u=>e.jsx(N.Item,{children:e.jsx(f,{to:"/leanite/article?id="+u,children:s.find(j=>j.id===u)?.title})})}):e.jsx(N,{header:e.jsx("div",{children:"标签总览"}),pagination:{position:"bottom",align:"center",pageSize:5,total:i.length},footer:e.jsx(A,{style:{float:"right"},children:e.jsx(T,{type:"primary",onClick:()=>{O(!0),l("/leanite/modifyTags")},children:"添加新标签"})}),dataSource:i,renderItem:u=>{const j=i.findIndex(I=>I===u),M=I=>{const $=i[j].name;$!==I.currentTarget.value&&(i[j].name=I.currentTarget.value,c(j,$),g(i)),n[j]=!1,b(n),l("/leanite/modifyTags")};return e.jsx(N.Item,{actions:[e.jsx(T,{onClick:()=>{n[j]=!0,b(n),l("/leanite/modifyTags")},children:"重命名"}),e.jsx(z,{title:"删除标签",description:"你确定要删除标签吗？",onConfirm:()=>{x(j),i.splice(j,1),g(i),l("/leanite/modifyTags")},okText:"确认",cancelText:"取消",children:e.jsx(T,{danger:!0,children:"删除"})})],children:n[j]?e.jsx(L,{defaultValue:u.name,defaultChecked:!0,onPressEnter:M,onBlur:M}):e.jsx(f,{to:"/leanite/modifyTags?name="+u.name,children:u.name})},j)}})}),e.jsxs(ye,{open:C,title:"创建新标签",onCancel:u=>{O(!1),y(""),l("/leanite/modifyTags")},onOk:t,children:[e.jsxs(A,{direction:"horizontal",children:["标签名称：",e.jsx(L,{placeholder:"新标签名称",defaultChecked:!0,value:k,onChange:u=>y(u.currentTarget.value),onPressEnter:t,onBlur:t})]}),e.jsx(A,{style:{marginTop:"15px"},children:"你稍后可以在标签管理页面添加所属的文章。"})]})]})}const P=i=>e.jsx(A,{style:{marginTop:"5px"},children:i.children});let te=!1;const E={name:"",desc:"",avatarURL:"",bulletin:"",blogIcon:""};let ne;function qe(){const i=_(),d=()=>{s(E.name),r(E.desc),b(E.avatarURL),o(E.bulletin),c(E.blogIcon),i("/leanite/settings")};h.useEffect(()=>(w.subscribe("setAuth",(t,F)=>{F?(ne="",new p.Query("Settings").equalTo("owner","admin").find().then(B=>{ne=B[0].get("objectId"),E.name=B[0].get("name"),E.desc=B[0].get("desc"),E.avatarURL=B[0].get("avatarURL"),E.bulletin=B[0].get("bulletin"),E.blogIcon=B[0].get("blogIcon"),d()})):(R.error("您需要登录"),te=!0,i("/leanite/authentication"))}),te||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),te=!1}),[]);const[g,s]=h.useState(""),[a,r]=h.useState(""),[n,b]=h.useState(""),[m,o]=h.useState(""),[l,c]=h.useState(""),[x,C]=h.useState(""),[O,k]=h.useState(""),y=()=>{const t=p.Object.createWithoutData("Settings",ne);t.set("name",g),t.set("desc",a),t.set("avatarURL",n),t.set("bulletin",m),t.set("blogIcon",l),t.set("passkey1",J.md5(x+"+"+J.md5(O))),t.set("passkey2",J.md5(O+"+"+J.md5(x))),t.save().then(()=>{R.success("保存成功！"),i("/leanite/home")})};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs(A,{style:{width:"100%"},children:[e.jsx("h2",{children:"设置"}),e.jsx(T,{style:{float:"right"},onClick:d,children:"撤销"}),e.jsx(z,{title:"确认保存",description:"你确定要保存设置吗？此操作不可撤销。",onConfirm:y,okText:"确认",cancelText:"取消",style:{float:"right"},children:e.jsx(T,{type:"primary",children:"保存"})})]}),e.jsx("h3",{children:"个人信息"}),e.jsxs(P,{children:["名称：",e.jsx(L,{value:g,onChange:t=>s(t.currentTarget.value),placeholder:"取个名字吧……"})]}),e.jsxs(P,{children:["简介：",e.jsx(L,{value:a,onChange:t=>r(t.currentTarget.value)})]}),e.jsxs(P,{children:["头像 URL：",e.jsx(L,{value:n,onChange:t=>b(t.currentTarget.value),placeholder:"头像 URL……"})]})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"公告板"}),e.jsx(P,{children:e.jsxs(A,{direction:"vertical",children:["公告信息：",e.jsx(L.TextArea,{value:m,style:{width:"100%"},onChange:t=>o(t.currentTarget.value),placeholder:"写些什么吧……"})]})})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"博客配置"}),e.jsxs(P,{children:["博客左上角图标 URL：",e.jsx(L,{value:l,onChange:t=>c(t.currentTarget.value),placeholder:"图标 URL……"})]})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"账号信息"}),"由于您的账号密码被加密存储，我们并不知道具体信息。所以此处没有提供您之前的信息，敬请谅解！",e.jsxs(P,{children:["用户名：",e.jsx(L,{value:x,onChange:t=>C(t.currentTarget.value),placeholder:"用户名"})]}),e.jsxs(P,{children:["密码：",e.jsx(L.Password,{value:O,onChange:t=>k(t.currentTarget.value),placeholder:"密码"})]})]})]})}const We=[{path:"/leanite/",element:e.jsx(Le,{to:"/leanite/home"})},{path:"/leanite/home",element:e.jsx(Je,{})},{path:"/leanite/tag",element:e.jsx(Ee,{})},{path:"/leanite/article",element:e.jsx(Ue,{})},{path:"/leanite/authentication",element:e.jsx(_e,{})},{path:"/leanite/adminHome",element:e.jsx(He,{})},{path:"/leanite/modifyArticle",element:e.jsx(ze,{})},{path:"/leanite/modifyTags",element:e.jsx(Qe,{})},{path:"/leanite/settings",element:e.jsx(qe,{})}],{Header:$e,Footer:Ve,Content:Ke}=ge,Ge=[{key:"1",label:e.jsx(f,{to:"/leanite/home",children:"首页"}),icon:e.jsx(Q,{})},{key:"2",label:e.jsx(f,{to:"/leanite/tag",children:"标签"}),icon:e.jsx(he,{})},{key:"3",label:e.jsx(f,{to:"/leanite/article",children:"归档"}),icon:e.jsx(Ae,{})},{key:"4",label:"阅读",icon:e.jsx(Oe,{})}],Ye=[{key:"5",label:e.jsx(f,{to:"/leanite/adminHome",children:"控制台"}),icon:e.jsx(Te,{})},{key:"6",label:e.jsx(f,{to:"/leanite/modifyArticle",children:"文章管理"}),icon:e.jsx(we,{})},{key:"7",label:e.jsx(f,{to:"/leanite/modifyTags",children:"标签管理"}),icon:e.jsx(he,{})},{key:"8",label:e.jsx(f,{to:"/leanite/settings",children:"设置"}),icon:e.jsx(Ce,{})}];new p.Object("Init").save().then(i=>new p.Query("Init").find().then(d=>{console.log(d.length),d.length<=1?Re():U(d[0]).destroy()}));let ie=!1;function Ze(){const i=Ne(We);let d=[],g=[];const s=_(),a=me(),[r]=q();let[n,b]=h.useState({name:"",desc:"",avatarURL:"",bulletin:"",blogIcon:""});function m(){new p.Query("BlogMeta").find().then(y=>{d=y.map(t=>U(t)),localStorage.setItem("blogMeta",JSON.stringify(d.map(t=>t.toFullJSON()))),localStorage.setItem("blogMetaOriginal",JSON.stringify(d.map(t=>t.toFullJSON())))})}function o(){new p.Query("Tags").find().then(y=>{g=y.map(t=>U(t)),localStorage.setItem("tags",JSON.stringify(g)),localStorage.setItem("tagsOriginal",JSON.stringify(g))})}h.useEffect(()=>(m(),setTimeout(o,500),new p.Query("Settings").equalTo("owner","admin").find().then(y=>{n.name=y[0].get("name"),n.desc=y[0].get("desc"),n.avatarURL=y[0].get("avatarURL"),n.bulletin=y[0].get("bulletin"),n.blogIcon=y[0].get("blogIcon"),b(n),s(a.pathname+a.search)}),w.subscribe("auth",()=>{ie=!0,s("/leanite/adminHome")}),w.subscribe("isAuthed",()=>w.publish("setAuth",ie)),()=>{w.unsubscribe("auth")}),[]);const[l,c]=h.useState([]),[x,C]=h.useState(!1);h.useEffect(()=>{a.pathname.includes("/leanite/adminHome")||a.pathname.includes("/leanite/modify")||a.pathname.includes("/leanite/settings")?(C(!0),a.pathname.includes("/leanite/modifyArticle")?c(["6"]):a.pathname.includes("/leanite/modifyTags")?c(["7"]):a.pathname.includes("/leanite/settings")?c(["8"]):c(["5"])):(C(!1),a.search.length>0?a.pathname.includes("/leanite/article")?(c(["4"]),new p.Query("BlogContent").equalTo("id",r.get("id")).find().then(y=>{k(U(y[0]))})):c(["2"]):a.pathname.includes("/leanite/tag")?c(["2"]):a.pathname.includes("/leanite/article")?c(["3"]):c(["1"]))},[a]);let[O,k]=h.useState();return e.jsxs(ge,{className:"App",style:{backgroundColor:"#fafafa",width:"100%"},children:[e.jsxs($e,{style:{boxShadow:"0 5px 20px 0px rgba(0,0,0,0.04)",marginBottom:"15px"},children:[e.jsx(f,{to:"/leanite/home",children:e.jsx(le,{src:n.blogIcon})}),e.jsx(A,{style:{float:"right"},children:x?e.jsx(T,{danger:!0,type:"primary",onClick:()=>{ie=!1,s("/leanite/home")},children:"退出登录"}):e.jsx(T,{type:"primary",onClick:()=>s("/leanite/authentication"),children:"控制台"})})]}),e.jsx(Ke,{children:e.jsxs(Se,{children:[e.jsx(V,{span:2}),e.jsx(V,{span:12,children:i}),e.jsx(V,{span:1}),e.jsxs(V,{span:7,children:[e.jsxs(S,{children:[e.jsx("h3",{children:"公告"}),e.jsx("div",{style:{textAlign:"center"},children:n.bulletin})]}),e.jsx(re,{style:{marginTop:"30px",borderRadius:"7px",boxShadow:"0 0 40px 0px rgba(0,0,0,0.04)",width:"100%"},children:e.jsx(re.Meta,{avatar:e.jsx(le,{src:n.avatarURL}),title:n.name,description:n.desc})}),e.jsx(S,{children:x?e.jsx(oe,{mode:"inline",theme:"light",items:Ye,defaultSelectedKeys:["5"],selectedKeys:l,selectable:!1}):e.jsx(oe,{mode:"inline",theme:"light",items:Ge,defaultSelectedKeys:["1"],selectedKeys:l,selectable:!1})}),e.jsx("div",{style:{marginTop:"30px",width:"100%",color:"lightgrey"},children:"Leanite Blog, 版本 0.1.0"})]})]})}),e.jsx(Ve,{style:{backgroundColor:"rgba(0,0,0,0)"}})]})}p.init({appId:ke,appKey:Be,serverURL:De});const Xe=be.createRoot(document.getElementById("root"));Xe.render(e.jsx(je.StrictMode,{children:e.jsx(Ie,{theme:{components:{Layout:{headerBg:"white"}}},children:e.jsx(ve,{children:e.jsx(Ze,{})})})}));
