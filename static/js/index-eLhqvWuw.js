import{j as e,r as h,a as xe}from"./react-pyWNicHf.js";import{b as je}from"./react-dom-DaPlfP5C.js";import{A as m}from"./leancloud-storage-o0EwsFi_.js";import{s as R,S as O,T as ie,B as K,L as N,D as G,F as H,I as L,a as T,P as z,C as ae,M as be,b as de,A as re,R as ye,c as V,d as oe,e as le,f as Se}from"./antd-DAS6H9JJ.js";import{L as f,u as q,B as Ie}from"./react-router-dom-CVtk8eOe.js";import{B as Q,C as ve,D as Te,E as ge,G as we,H as Ce,J as Ae}from"./@ant-design-CkDbgUbb.js";import{Q as he,i as Oe}from"./md-editor-rt-BcBZackr.js";import{u as ue,a as _,d as Me,e as Le}from"./react-router-j14Ueec2.js";import{m as J}from"./js-md5-UmE8huoo.js";import{p as w}from"./pubsub-js-DKsWzxX6.js";import"./classnames-DrtxxsZ5.js";import"./scheduler-Bb8JjhAW.js";import"./rc-util-DrNLs0Sa.js";import"./@babel-BlIIM1Tk.js";import"./react-is-BpBQ4hf7.js";import"./rc-resize-observer-DDH0kaLk.js";import"./resize-observer-polyfill-D6qJbdzf.js";import"./rc-motion-C-kdRULV.js";import"./rc-dropdown-hdxrbMhT.js";import"./@rc-component-CfJTwUQL.js";import"./rc-menu-BDE0ZiR4.js";import"./rc-overflow-BJ3Kw50f.js";import"./rc-tabs-UcLePfXK.js";import"./rc-select-B1Dsgljj.js";import"./rc-virtual-list-c4piO5bs.js";import"./rc-checkbox-D4dVWoQK.js";import"./rc-field-form-tuI5lY9E.js";import"./scroll-into-view-if-needed-Bq0bK-M8.js";import"./compute-scroll-into-view-Bl8rNFhg.js";import"./rc-dialog-BT-3KWbF.js";import"./rc-input-CXGxMpf6.js";import"./rc-textarea-BJkS2gDC.js";import"./rc-pagination-DTV34-xE.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-Dv4Nucp9.js";import"./rc-tooltip-D7AYWjNN.js";import"./rc-picker-Ce8wNz7V.js";import"./@remix-run-Ci2Y9YYq.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./@vavt-BhS2ZNLz.js";import"./lucide-react-B1CG_ASX.js";import"./@codemirror-kXN7IW_d.js";import"./@lezer-BkZr8DQx.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bs6eFhZE.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-bWEtUbjf.js";import"./markdown-it-B_KdP_AI.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-DaOgEp9O.js";import"./markdown-it-image-figures-IpqUZCLv.js";import"./markdown-it-sub-Bxi31R0z.js";import"./markdown-it-sup-Bp2DoVCN.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function g(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=g(a);fetch(a.href,o)}})();function Ne(){const n=new m.Object("Init"),d=new m.Object("LeaniteInfo");d.set("version","0.1.0");const g=new m.Object("BlogMeta");g.set("title","Hello World!"),g.set("id","1"),g.set("reader",1),g.set("tags",["Leanite"]);const i=new m.Object("BlogContent");i.set("title","Hello World!"),i.set("id","1"),i.set("content",`**欢迎使用 Leanite！**这是你的第一篇博客。

访问 [Leanite 的 GitHub 仓库](https://github.com/copws/) 获取更多信息。`);const a=new m.Object("Settings");a.set("owner","admin"),a.set("bulletin","Hello, World!");const o=new m.Object("Tags");o.set("name","Leanite"),o.set("ids",["1"]),m.Object.saveAll([n,d,g,i,a,o]).then(s=>R.success("初始化成功！"),s=>R.error("初始化失败"))}const U=n=>m.parseJSON(n.toFullJSON());function Y(n,d){for(let g in n){const i=n[g];if(!d.find(a=>a===i))return!1}return!0}const Re="6etdzH2DJEoNM5Dq80rfyljk-gzGzoHsz",ke="3EThSFNCw1QZRRN2JyGNneq5",Be="https://6etdzh2d.lc-cn-n1-shared.com";function S(n){return e.jsx(O,{direction:"vertical",style:{marginTop:"30px",padding:"20px",backgroundColor:"white",borderRadius:"7px",boxShadow:"0 0 40px 0px rgba(0,0,0,0.04)",width:"100%"},children:n.children})}const me=n=>{const{meta:d}=n;return e.jsxs(O,{direction:"horizontal",children:[e.jsx("strong",{children:e.jsx(f,{to:"/article?id="+d.id,style:{color:"black"},children:d.title})}),d.tags.map(g=>e.jsx(ie,{children:e.jsx(f,{to:"/tag?name="+g,children:g})})),e.jsx("div",{style:{color:"grey"},children:new Date(d.createdAt).toLocaleDateString()})]})},ce=n=>{const{children:d}=n;return e.jsx(O,{direction:"horizontal",className:"leanite-minicard",children:d})};function De(){let[n,d]=h.useState([]),[g,i]=h.useState([]),[a]=q(),o=a.get("name");return h.useEffect(()=>{d(JSON.parse(localStorage.getItem("tags"))),i(JSON.parse(localStorage.getItem("blogMeta")))},[]),e.jsxs("div",{children:[e.jsxs(S,{children:[e.jsx(K,{items:[{title:e.jsx(f,{to:"/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/tag",children:"标签"})}]}),e.jsxs(O,{style:{marginTop:"15px"},children:[e.jsx(f,{style:{color:"black"},to:"/tag",children:e.jsx(ce,{children:e.jsx("strong",{children:"标签总览"})})}),n.map(s=>e.jsx(f,{style:{color:"black"},to:"/tag?name="+s.name,children:e.jsx(ce,{children:e.jsx("strong",{children:"#"+s.name})})}))]})]}),e.jsx(S,{children:o&&n.length>0?e.jsx(N,{header:e.jsx("div",{children:o}),dataSource:n.find(s=>s.name===o)?.ids,renderItem:s=>e.jsx(N.Item,{children:e.jsx(me,{meta:g.find(b=>b.id===s)})})}):e.jsx(N,{header:e.jsx("div",{children:"标签总览"}),dataSource:n,renderItem:s=>e.jsx(N.Item,{children:e.jsx(f,{to:"/tag?name="+s.name,children:s.name})})})})]})}function Ee(){const[n,d]=h.useState([]),[g,i]=h.useState([]);return h.useEffect(()=>{i(JSON.parse(localStorage.getItem("blogMeta"))),(async()=>d(await new m.Query("BlogContent").descending("createdAt").limit(5).find()))()},[]),e.jsxs("div",{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/home",children:"首页"})}]})}),n.map(a=>{const o=g.find(s=>s.id===a.get("id"));return e.jsxs(S,{children:[e.jsx("h2",{children:e.jsx(f,{to:"/article?id="+a.get("id"),style:{color:"black"},children:a.get("title")})}),e.jsxs(O,{style:{color:"grey",width:"100%"},children:["阅读量：",o.reader-1,e.jsx(G,{type:"vertical"}),"发布：",new Date(o.createdAt).toLocaleDateString(),e.jsx(G,{type:"vertical"}),"标签：",o?.tags.length>0?o.tags.map(s=>e.jsx(ie,{children:e.jsx(f,{to:"/tag?name="+s,children:s})})):"无"]}),e.jsx("div",{style:{marginTop:"10px"},children:e.jsx(he,{value:a.get("content"),previewTheme:"github",style:{width:"100%"}})})]},Math.random())})]})}const Je=()=>{const n=ue(),[d]=q();let[g,i]=h.useState(),[a,o]=h.useState([]),[s,b]=h.useState([[]]);const p=d.get("id"),l=_();h.useEffect(()=>{if(a=JSON.parse(localStorage.getItem("blogMeta")),o(a),p&&(new m.Query("BlogContent").equalTo("id",p).find().then(c=>{i(U(c[0]))}),new m.Query("BlogMeta").equalTo("id",p).find().then(c=>setTimeout(()=>U(c[0]).increment("reader",1).save(),5e3))),!p&&(s.length<=0||s[0].length<=0)){s=[];let c=1/0;for(let x in a){const C=a[x],A=new Date(C.createdAt).getFullYear();A<c?(s.push([C]),c=A):s[s.length-1].push(C)}b(s),l("/article")}},[n]);let r={title:"",createdAt:"",reader:1,tags:[]};return p&&a.length>0&&(r=a.find(c=>c.id===p)),e.jsx("div",{children:e.jsx("div",{children:p?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/article?id="+p,children:r.title})}]})}),e.jsxs(S,{children:[e.jsx("h1",{children:r.title}),e.jsxs(O,{style:{color:"grey"},children:["阅读量：",r.reader-1,e.jsx(G,{type:"vertical"}),"发布：",new Date(r.createdAt).toLocaleDateString(),e.jsx(G,{type:"vertical"}),"标签：",r?.tags.length>0?r.tags.map(c=>e.jsx(ie,{children:e.jsx(f,{to:"/tag?name="+c,children:c})})):"无"]}),e.jsx("div",{style:{marginTop:"10px"},children:e.jsx(he,{value:g?.get("content"),previewTheme:"github"})})]},Math.random())]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx(K,{items:[{title:e.jsx(f,{to:"/home",children:e.jsx(Q,{})})},{title:e.jsx(f,{to:"/article",children:"归档"})}]})}),s.length>0&&s[0].length>0?s.map(c=>e.jsxs(S,{children:[e.jsx("h3",{children:new Date(c[0].createdAt).getFullYear()}),c.map(x=>e.jsx(me,{meta:x}))]})):e.jsx(e.Fragment,{})]})})})},Ue=n=>{J.md5(n.username+"+"+J.md5(n.password))===pe&&J.md5(n.password+"+"+J.md5(n.username))===fe?(R.success("验证成功！"),w.publish("auth")):R.error("验证失败！")},Fe=n=>{for(let d in n.errorFields)R.error(n.errorFields[d].errors)};let pe,fe;function Pe(){return h.useEffect(()=>{new m.Query("Settings").equalTo("owner","admin").find().then(n=>{const d=n[0];pe=d.get("passkey1"),fe=d.get("passkey2")})},[]),e.jsx(S,{children:e.jsxs(H,{name:"basic",labelCol:{span:4},wrapperCol:{span:18},style:{maxWidth:600},onFinish:Ue,onFinishFailed:Fe,autoComplete:"off",children:[e.jsx(H.Item,{wrapperCol:{offset:4,span:18},children:e.jsx("h3",{children:"管理员登录"})}),e.jsx(H.Item,{label:"账号",name:"username",rules:[{required:!0,message:"请输入管理员账号"}],children:e.jsx(L,{})}),e.jsx(H.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入管理员密码"}],children:e.jsx(L.Password,{})}),e.jsx(H.Item,{wrapperCol:{offset:4,span:18},children:e.jsx(T,{type:"primary",htmlType:"submit",children:"确认"})})]})})}let Z=!1;function _e(){const n=_();h.useEffect(()=>(w.subscribe("setAuth",(g,i)=>{i||(R.error("您需要登录"),Z=!0,n("/authentication"))}),Z||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),Z=!1}),[]);const d=()=>{const g=JSON.parse(localStorage.getItem("tags")),i=JSON.parse(localStorage.getItem("blogMeta"));let a=JSON.parse(localStorage.getItem("tagsOriginal")),o=JSON.parse(localStorage.getItem("blogMetaOriginal"));const s=[],b=[];console.log(g,i,a,o);for(let p in i){const l=i[p];if(l.objectId.length<=0){console.log("This meta hasn't created yet, "+l.title,l.id);const r=new m.Object("BlogMeta");r.set("title",l.title),r.set("reader",1),r.set("tags",l.tags),r.set("id",l.id),b.push(r)}else{const r=o.find(x=>x.id===l.id);if(o=o.filter(x=>x.id!==l.id),!r)continue;let c;r.title!==l.title&&(c=m.Object.createWithoutData("BlogMeta",r.objectId),c.set("title",l.title)),console.log(l.title,r.tags,l.tags,Y(r.tags,l.tags)),Y(r.tags,l.tags)||(c||(c=m.Object.createWithoutData("BlogMeta",r.objectId)),c.set("tags",l.tags)),c&&b.push(c)}}for(let p in g){const l=g[p];if(l.objectId.length<=0){console.log("This tag hasn't created yet, "+l.name);const r=new m.Object("Tags");r.set("name",l.name),r.set("ids",l.ids),s.push(r)}else{const r=a.find(x=>x.objectId===l.objectId);if(a=a.filter(x=>x.objectId!==l.objectId),!r)continue;let c;r.name!==l.name&&(c=m.Object.createWithoutData("Tags",r.objectId),c.set("name",l.name)),Y(r.ids,l.ids)||(c||(c=m.Object.createWithoutData("tags",r.objectId)),c.set("ids",l.ids)),c&&s.push(c)}}if(console.log(b,s,a,o),b.length<=0&&s.length<=0&&a.length<=0&&o.length<=0)console.log("everything is up-to-date");else{m.Object.saveAll(s).then(()=>console.log("tag 上传成功！")),m.Object.saveAll(b).then(()=>console.log("meta 上传成功！"));for(let p in a)m.Object.createWithoutData("Tags",a[p].objectId).destroy();for(let p in o)m.Object.createWithoutData("BlogMeta",o[p].objectId).destroy();localStorage.setItem("blogMetaOriginal",JSON.stringify(i)),localStorage.setItem("tagsOriginal",JSON.stringify(g))}};return e.jsxs("div",{children:[e.jsxs(S,{children:[e.jsx("strong",{children:"Leanite 控制台"}),e.jsxs("p",{children:["这个小按钮可以帮你把更改保存至 LeanCloud 云端，所以更改后不要忘了保存哦！",e.jsx("br",{}),"但是文章内容的编辑和设置选项是直接保存的，无需通过这个按钮。"]}),e.jsx(T,{type:"primary",onClick:d,children:"上传至云端"})]}),e.jsx(S,{children:e.jsxs("p",{children:[e.jsx("strong",{children:"使用说明"}),e.jsx("br",{}),e.jsx("br",{}),"控制台中，你可以更改文章、标签及设置。",e.jsx("br",{}),"具体帮助详见 ",e.jsx("a",{href:"https://github.com/copws/leanite",children:"GitHub"}),"。"]})})]})}let X=!1;function He(){let[n,d]=h.useState([]);const g=t=>{localStorage.setItem("tags",JSON.stringify(t)),d(t)};let[i,a]=h.useState([]);const o=t=>{localStorage.setItem("blogMeta",JSON.stringify(t)),a(t)},s=_();let[b]=q();const p=b.get("id"),l=b.get("new");let r={title:"",createdAt:"",id:"",objectId:"",reader:0,tags:[],updatedAt:""};h.useEffect(()=>(w.subscribe("setAuth",(t,F)=>{F?(console.log("%"),g(JSON.parse(localStorage.getItem("tags"))),o(JSON.parse(localStorage.getItem("blogMeta")))):(R.error("您需要登录"),X=!0,s("/authentication"))}),X||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),X=!1}),[]);const[c,x]=h.useState(),[C,A]=h.useState(""),[k,y]=h.useState();return p&&C.length<=0&&(l?r={objectId:"",createdAt:"",updatedAt:"",title:"默认标题",tags:[],reader:0,id:""}:r=i.find(t=>t.id===p),console.log(r),A(r.title),s(l?"/modifyArticle?id="+p+"&new=1":"/modifyArticle?id="+p)),e.jsx("div",{children:p&&i.length>0?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(O,{direction:"horizontal",children:[e.jsx("strong",{children:"标题："}),e.jsx(L,{value:C,onChange:t=>A(t.currentTarget.value)}),e.jsx(z,{title:l?"确认创建":"确认更改",description:"你确定要"+(l?"创建":"更改")+"文章吗？此操作不可撤销。",onConfirm:()=>{l||(i[i.findIndex(t=>t.id===p)].title=C,o(i)),k?.set("title",C),k?.set("content",c),k?.save().then(t=>{R.success("成功"),l&&i.push({objectId:"",createdAt:"",title:C,tags:[],reader:0,id:t.get("id"),updatedAt:""}),o(i),s("/modifyArticle")},t=>R.error("出错了！"+t))},okText:"确认",cancelText:"取消",children:e.jsx(T,{type:"primary",children:"完成"})}),e.jsx(z,{title:"确认取消",description:"你确定要取消"+(l?"创建":"更改")+"吗？此操作不可撤销。",onConfirm:()=>{A(""),x(""),y(void 0),s("/modifyArticle")},okText:"确认",cancelText:"取消",children:e.jsx(T,{children:"取消"})})]})}),e.jsx(Oe,{value:c,onChange:t=>{x(t)},style:{marginTop:"30px",border:0},previewTheme:"github"})]}):e.jsx(S,{children:e.jsx(N,{header:"文章总览",pagination:{position:"bottom",align:"center",pageSize:5,total:i.length},footer:e.jsx(T,{onClick:()=>{const t=new m.Object("BlogContent");t.set("id",J.md5(new Date().toString()+Math.random())),t.set("content",""),t.set("title",""),console.log(t),y(t),s("/modifyArticle?id="+t.get("id")+"&new=1")},type:"primary",style:{float:"right"},children:"创建新文章"}),dataSource:i,renderItem:t=>{const F=i.findIndex(D=>D===t);function B(){for(let D in t.tags){const W=n.findIndex(v=>v.name===t.tags[D]);n[W].ids=n[W].ids.filter(v=>v!==t.id)}g(n)}return e.jsx(N.Item,{actions:[e.jsx(T,{onClick:()=>{new m.Query("BlogContent").equalTo("id",t.id).find().then(D=>{x(U(D[0]).get("content")),y(U(D[0])),s("/modifyArticle?id="+t.id)}),s("/modifyArticle?id="+t.id)},children:"编辑"}),e.jsx(z,{title:"删除文章",description:"你确定要删除文章吗？",onConfirm:()=>{B(),i.splice(F,1),o(i),console.log(n),s("/modifyArticle")},okText:"确认",cancelText:"取消",children:e.jsx(T,{danger:!0,children:"删除"})})],children:e.jsx(f,{to:"/article?id="+t.id,children:t.title})})}})})})}let ee=!1;function ze(){let[n,d]=h.useState([]);const g=u=>{localStorage.setItem("tags",JSON.stringify(u)),d(u)};let[i,a]=h.useState([]);const o=u=>{localStorage.setItem("blogMeta",JSON.stringify(u)),a(u)};let[s,b]=h.useState(new Array(n.length).fill(!1)),[p]=q(),l=p.get("name");const r=_();h.useEffect(()=>(w.subscribe("setAuth",(u,j)=>{j?(g(JSON.parse(localStorage.getItem("tags"))),o(JSON.parse(localStorage.getItem("blogMeta")))):(R.error("您需要登录"),ee=!0,r("/authentication"))}),ee||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),ee=!1}),[r]);function c(u,j){const M=n[u];for(let I in i)M.ids.includes(i[I].id)&&(i[I].tags=i[I].tags.filter($=>$!==j),i[I].tags.push(M.name));o(i),console.log(i)}function x(u){const j=n[u];for(let M in i)i[M].tags=i[M].tags.filter(I=>I!==j.name);o(i),console.log(i),s.splice(u,1),b(s)}let[C,A]=h.useState(!1),[k,y]=h.useState("");const t=()=>{k.length>0&&(n.push({name:k,ids:[],objectId:"",createdAt:"",updatedAt:""}),g(n)),A(!1),y(""),r("/modifyTags")};let[F,B]=h.useState(!1),[D,W]=h.useState([]);const v=n?.find(u=>u.name===l);return e.jsxs("div",{children:[e.jsx(S,{children:l&&n.length>0?F?e.jsx(ae.Group,{style:{width:"100%"},onChange:u=>{console.log("checked = ",u),W(u)},defaultValue:v?.ids,children:e.jsx(N,{style:{width:"100%"},pagination:{position:"bottom",align:"center",pageSize:5,total:i.length},header:e.jsx("div",{children:l}),footer:e.jsx(T,{onClick:()=>{if(console.log(v),v.ids!==D){for(let u in D){const j=D[u],M=i.findIndex(I=>I.id===j);!v?.ids.includes(j)&&!i[M].tags.includes(v.name)?i[M].tags.push(v.name):v.ids=v.ids.filter(I=>I!==j)}for(let u in v.ids){const j=v.ids[u],M=i.findIndex(I=>I.id===j);i[M].tags=i[M].tags.filter(I=>I!==v?.name)}o(i),n[n.findIndex(u=>u.name===l)].ids=D,g(n),B(!1),r("/modifyTags?name="+l)}},type:"primary",style:{float:"right"},children:"完成"}),dataSource:i,renderItem:u=>e.jsx(N.Item,{children:e.jsx(ae,{value:u.id,children:u.title})})})}):e.jsx(N,{header:e.jsx("div",{children:l}),pagination:{position:"bottom",align:"center",pageSize:5,total:v.ids.length},footer:e.jsxs(O,{direction:"horizontal",style:{float:"right"},children:[e.jsx(T,{type:"primary",onClick:()=>{B(!0),r("/modifyTags?name="+l)},children:"添加或删除文章……"}),e.jsx(f,{to:"/modifyTags",children:e.jsx(T,{children:"返回上一级"})})]}),dataSource:v?.ids,renderItem:u=>e.jsx(N.Item,{children:e.jsx(f,{to:"/article?id="+u,children:i.find(j=>j.id===u)?.title})})}):e.jsx(N,{header:e.jsx("div",{children:"标签总览"}),pagination:{position:"bottom",align:"center",pageSize:5,total:n.length},footer:e.jsx(O,{style:{float:"right"},children:e.jsx(T,{type:"primary",onClick:()=>{A(!0),r("/modifyTags")},children:"添加新标签"})}),dataSource:n,renderItem:u=>{const j=n.findIndex(I=>I===u),M=I=>{const $=n[j].name;$!==I.currentTarget.value&&(n[j].name=I.currentTarget.value,c(j,$),g(n)),s[j]=!1,b(s),r("/modifyTags")};return e.jsx(N.Item,{actions:[e.jsx(T,{onClick:()=>{s[j]=!0,b(s),r("/modifyTags")},children:"重命名"}),e.jsx(z,{title:"删除标签",description:"你确定要删除标签吗？",onConfirm:()=>{x(j),n.splice(j,1),g(n),r("/modifyTags")},okText:"确认",cancelText:"取消",children:e.jsx(T,{danger:!0,children:"删除"})})],children:s[j]?e.jsx(L,{defaultValue:u.name,defaultChecked:!0,onPressEnter:M,onBlur:M}):e.jsx(f,{to:"/modifyTags?name="+u.name,children:u.name})},j)}})}),e.jsxs(be,{open:C,title:"创建新标签",onCancel:u=>{A(!1),y(""),r("/modifyTags")},onOk:t,children:[e.jsxs(O,{direction:"horizontal",children:["标签名称：",e.jsx(L,{placeholder:"新标签名称",defaultChecked:!0,value:k,onChange:u=>y(u.currentTarget.value),onPressEnter:t,onBlur:t})]}),e.jsx(O,{style:{marginTop:"15px"},children:"你稍后可以在标签管理页面添加所属的文章。"})]})]})}const P=n=>e.jsx(O,{style:{marginTop:"5px"},children:n.children});let te=!1;const E={name:"",desc:"",avatarURL:"",bulletin:"",blogIcon:""};let se;function Qe(){const n=_(),d=()=>{i(E.name),o(E.desc),b(E.avatarURL),l(E.bulletin),c(E.blogIcon),n("/settings")};h.useEffect(()=>(w.subscribe("setAuth",(t,F)=>{F?(se="",new m.Query("Settings").equalTo("owner","admin").find().then(B=>{se=B[0].get("objectId"),E.name=B[0].get("name"),E.desc=B[0].get("desc"),E.avatarURL=B[0].get("avatarURL"),E.bulletin=B[0].get("bulletin"),E.blogIcon=B[0].get("blogIcon"),d()})):(R.error("您需要登录"),te=!0,n("/authentication"))}),te||w.publish("isAuthed"),()=>{w.unsubscribe("setAuth"),te=!1}),[]);const[g,i]=h.useState(""),[a,o]=h.useState(""),[s,b]=h.useState(""),[p,l]=h.useState(""),[r,c]=h.useState(""),[x,C]=h.useState(""),[A,k]=h.useState(""),y=()=>{const t=m.Object.createWithoutData("Settings",se);t.set("name",g),t.set("desc",a),t.set("avatarURL",s),t.set("bulletin",p),t.set("blogIcon",r),t.set("passkey1",J.md5(x+"+"+J.md5(A))),t.set("passkey2",J.md5(A+"+"+J.md5(x))),t.save().then(()=>{R.success("保存成功！"),n("/home")})};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs(O,{style:{width:"100%"},children:[e.jsx("h2",{children:"设置"}),e.jsx(T,{style:{float:"right"},onClick:d,children:"撤销"}),e.jsx(z,{title:"确认保存",description:"你确定要保存设置吗？此操作不可撤销。",onConfirm:y,okText:"确认",cancelText:"取消",style:{float:"right"},children:e.jsx(T,{type:"primary",children:"保存"})})]}),e.jsx("h3",{children:"个人信息"}),e.jsxs(P,{children:["名称：",e.jsx(L,{value:g,onChange:t=>i(t.currentTarget.value),placeholder:"取个名字吧……"})]}),e.jsxs(P,{children:["简介：",e.jsx(L,{value:a,onChange:t=>o(t.currentTarget.value)})]}),e.jsxs(P,{children:["头像 URL：",e.jsx(L,{value:s,onChange:t=>b(t.currentTarget.value),placeholder:"头像 URL……"})]})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"公告板"}),e.jsx(P,{children:e.jsxs(O,{direction:"vertical",children:["公告信息：",e.jsx(L.TextArea,{value:p,style:{width:"100%"},onChange:t=>l(t.currentTarget.value),placeholder:"写些什么吧……"})]})})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"博客配置"}),e.jsxs(P,{children:["博客左上角图标 URL：",e.jsx(L,{value:r,onChange:t=>c(t.currentTarget.value),placeholder:"图标 URL……"})]})]}),e.jsxs(S,{children:[e.jsx("h3",{children:"账号信息"}),"由于您的账号密码被加密存储，我们并不知道具体信息。所以此处没有提供您之前的信息，敬请谅解！",e.jsxs(P,{children:["用户名：",e.jsx(L,{value:x,onChange:t=>C(t.currentTarget.value),placeholder:"用户名"})]}),e.jsxs(P,{children:["密码：",e.jsx(L.Password,{value:A,onChange:t=>k(t.currentTarget.value),placeholder:"密码"})]})]})]})}const qe=[{path:"/",element:e.jsx(Me,{to:"/home"})},{path:"/home",element:e.jsx(Ee,{})},{path:"/tag",element:e.jsx(De,{})},{path:"/article",element:e.jsx(Je,{})},{path:"/authentication",element:e.jsx(Pe,{})},{path:"/adminHome",element:e.jsx(_e,{})},{path:"/modifyArticle",element:e.jsx(He,{})},{path:"/modifyTags",element:e.jsx(ze,{})},{path:"/settings",element:e.jsx(Qe,{})}],{Header:We,Footer:$e,Content:Ve}=de,Ke=[{key:"1",label:e.jsx(f,{to:"/home",children:"首页"}),icon:e.jsx(Q,{})},{key:"2",label:e.jsx(f,{to:"/tag",children:"标签"}),icon:e.jsx(ge,{})},{key:"3",label:e.jsx(f,{to:"/article",children:"归档"}),icon:e.jsx(Ce,{})},{key:"4",label:"阅读",icon:e.jsx(Ae,{})}],Ge=[{key:"5",label:e.jsx(f,{to:"/adminHome",children:"控制台"}),icon:e.jsx(ve,{})},{key:"6",label:e.jsx(f,{to:"/modifyArticle",children:"文章管理"}),icon:e.jsx(Te,{})},{key:"7",label:e.jsx(f,{to:"/modifyTags",children:"标签管理"}),icon:e.jsx(ge,{})},{key:"8",label:e.jsx(f,{to:"/settings",children:"设置"}),icon:e.jsx(we,{})}];new m.Object("Init").save().then(n=>new m.Query("Init").find().then(d=>{console.log(d.length),d.length<=1?Ne():U(d[0]).destroy()}));let ne=!1;function Ye(){const n=Le(qe);let d=[],g=[];const i=_(),a=ue(),[o]=q();let[s,b]=h.useState({name:"",desc:"",avatarURL:"",bulletin:"",blogIcon:""});function p(){new m.Query("BlogMeta").find().then(y=>{d=y.map(t=>U(t)),localStorage.setItem("blogMeta",JSON.stringify(d.map(t=>t.toFullJSON()))),localStorage.setItem("blogMetaOriginal",JSON.stringify(d.map(t=>t.toFullJSON())))})}function l(){new m.Query("Tags").find().then(y=>{g=y.map(t=>U(t)),localStorage.setItem("tags",JSON.stringify(g)),localStorage.setItem("tagsOriginal",JSON.stringify(g))})}h.useEffect(()=>(p(),setTimeout(l,500),new m.Query("Settings").equalTo("owner","admin").find().then(y=>{s.name=y[0].get("name"),s.desc=y[0].get("desc"),s.avatarURL=y[0].get("avatarURL"),s.bulletin=y[0].get("bulletin"),s.blogIcon=y[0].get("blogIcon"),b(s),i(a.pathname+a.search)}),w.subscribe("auth",()=>{ne=!0,i("/adminHome")}),w.subscribe("isAuthed",()=>w.publish("setAuth",ne)),()=>{w.unsubscribe("auth")}),[]);const[r,c]=h.useState([]),[x,C]=h.useState(!1);h.useEffect(()=>{a.pathname.includes("/adminHome")||a.pathname.includes("/modify")||a.pathname.includes("/settings")?(C(!0),a.pathname.includes("/modifyArticle")?c(["6"]):a.pathname.includes("/modifyTags")?c(["7"]):a.pathname.includes("/settings")?c(["8"]):c(["5"])):(C(!1),a.search.length>0?a.pathname.includes("/article")?(c(["4"]),new m.Query("BlogContent").equalTo("id",o.get("id")).find().then(y=>{k(U(y[0]))})):c(["2"]):a.pathname.includes("/tag")?c(["2"]):a.pathname.includes("/article")?c(["3"]):c(["1"]))},[a]);let[A,k]=h.useState();return e.jsxs(de,{className:"App",style:{backgroundColor:"#fafafa",width:"100%"},children:[e.jsxs(We,{style:{boxShadow:"0 5px 20px 0px rgba(0,0,0,0.04)",marginBottom:"15px"},children:[e.jsx(f,{to:"/home",children:e.jsx(re,{src:s.blogIcon})}),e.jsx(O,{style:{float:"right"},children:x?e.jsx(T,{danger:!0,type:"primary",onClick:()=>{ne=!1,i("/home")},children:"退出登录"}):e.jsx(T,{type:"primary",onClick:()=>i("/authentication"),children:"控制台"})})]}),e.jsx(Ve,{children:e.jsxs(ye,{children:[e.jsx(V,{span:2}),e.jsx(V,{span:12,children:n}),e.jsx(V,{span:1}),e.jsxs(V,{span:7,children:[e.jsxs(S,{children:[e.jsx("h3",{children:"公告"}),e.jsx("div",{style:{textAlign:"center"},children:s.bulletin})]}),e.jsx(oe,{style:{marginTop:"30px",borderRadius:"7px",boxShadow:"0 0 40px 0px rgba(0,0,0,0.04)",width:"100%"},children:e.jsx(oe.Meta,{avatar:e.jsx(re,{src:s.avatarURL}),title:s.name,description:s.desc})}),e.jsx(S,{children:x?e.jsx(le,{mode:"inline",theme:"light",items:Ge,defaultSelectedKeys:["5"],selectedKeys:r,selectable:!1}):e.jsx(le,{mode:"inline",theme:"light",items:Ke,defaultSelectedKeys:["1"],selectedKeys:r,selectable:!1})}),e.jsx("div",{style:{marginTop:"30px",width:"100%",color:"lightgrey"},children:"Leanite Blog, 版本 0.1.2"})]})]})}),e.jsx($e,{style:{backgroundColor:"rgba(0,0,0,0)"}})]})}m.init({appId:Re,appKey:ke,serverURL:Be});const Ze=je.createRoot(document.getElementById("root"));Ze.render(e.jsx(xe.StrictMode,{children:e.jsx(Se,{theme:{components:{Layout:{headerBg:"white"}}},children:e.jsx(Ie,{basename:"/leanite/",children:e.jsx(Ye,{})})})}));
